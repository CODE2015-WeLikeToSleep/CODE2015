<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="../../favicon.ico">
    <title>Healthy Voting</title>
    <link rel="stylesheet" href="http://netdna.bootstrapcdn.com/bootswatch/3.2.0/cerulean/bootstrap.min.css">
    <link rel="stylesheet" href="css/parliament.css">
    <style type="text/css">
    html {
      margin: 0;
      padding-top: 0;
    }

    .leaves {
      background: url('images/leaves.jpeg') no-repeat center center;
      color: white;
    }

    .canyon {
      background: url('images/canyon.jpg') no-repeat center center;
      color: white;
      margin-bottom: 2em;
    }

    </style>
  </head>

  <body>

    <div class="container-fluid">

      <!-- Static navbar -->
      <nav class="navbar navbar-default">
        <div class="container-fluid">
          <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="#">Healthy Voting</a>
          </div>
          <div id="navbar" class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
              <li><a href="#browse">Bils/Votes about Healthy Living</a></li>
              <li><a href="#representation">What is Proportional Representation</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
              <li><a href="#aboutCODE">CODE 2015</a></li>
            </ul>
          </div><!--/.nav-collapse -->
        </div><!--/.container-fluid -->
      </nav>

      <!-- Main component for a primary marketing message or call to action -->
      <div class="row leaves" style="padding: 70px; font-size: 130%;">
        <h1>Healthy Voting</h1>
        <p>Healthy living is important to you. Is it important to your elected representatives? What bills are being passed or failed?</p>

        <p>Would the results change if we used a different electoral system?</p>
        <p>
          <a class="btn btn-lg btn-primary" href="#browse" role="button">See Bills and Votes &raquo;</a>
        </p>
      </div>

      <div class="row" id="browse" style="padding: 3em; background-color: #BBBBBB;">
        <a class="anchor" name="browse"></a>

<div style="border:1px solid black; display: block; margin-bottom: 1em;">
  show the arrangement of actual and hypothetical parliament
  based on current selection of parliament<br>

<svg id="parlchart1" class="chart"></svg>
<svg id="parlchart2" class="chart"></svg>
</div>

<div id="parl_wrapper">

    <div>
        <h1>Parliament/Session</h1>
        <select id="parl_session" onchange="setDuration(this.options[this.selectedIndex].value)">
            <option value="41,2">41st Parliament, 2nd Session</option>
            <option value="41,1">41st Parliament, 1st Session</option>
            <option value="40,3">40th Parliament, 3rd Session</option>
            <option value="40,2">40th Parliament, 2nd Session</option>
            <!-- the 40th parliament, 1st session is dumb and has no real bills. -->
            <!--<option value="40,1">40th Parliament, 1st Session</option>-->
            <option value="39,2">39th Parliament, 2nd Session</option>
            <option value="39,1">39th Parliament, 1st Session</option>
        </select>
    </div>

    <script>
        function setDuration(s) {

            dur = ""

            switch (s) {
                case "41,2":
                    dur = "2013.10.16 - 2015.02.19";
                    break;
                case "41,1":
                    dur = "2011.06.02 - 2013.09.13";
                    break;
                case "40,3":
                    dur = "2010.03.03 - 2011.03.25";
                    break;
                case "40,2":
                    dur = "2009.01.26 - 2009.12.30";
                    break;
                case "39,2":
                    dur = "2007.10.16 - 2008.06.20";
                    break;
                case "39,1":
                    dur = "2006.04.03 - 2007.09.14";
                    break;
            }

            $('#parl_duration').text(dur);
        }
    </script>

    <h1>Duration: </h1> <div id="parl_duration"></div><br>

</div>

<div id="vote_wrapper">
    <h1>Vote: </h1><a id="lnkPrev" href="#">&#8656; </a><select id="votelist"></select><a id="lnkNext" href="#"> &#8658;</a><br>
    <h1>Bill: </h1><span id="bill_name"></span><br>
    <h1>Title: </h1><span id="desctext"></span><br>
</div>

<br>
<div id="vote_chart_wrapper">
    <div class="vote_chart">
        <h1>First Past the Post</h1><br>
        <svg id="chart1" class="chart"></svg>
    </div>
    <div class="vote_chart">
        <h1>Proportional Representation</h1><br>
        <svg id="chart2" class="chart"></svg>
    </div>
    <div class="vote_chart" style="text-align: left;">
        <h1 style="text-align:left;">Legend</h1><br>
        <table id="chart_legend">
            <tr>
                <td class="legend_colour conservative">&nbsp;&nbsp;&nbsp;&nbsp;</td>
                <td>Conservative</td>
            </tr>
            <tr>
                <td class="legend_colour ndp">&nbsp;&nbsp;&nbsp;&nbsp;</td>
                <td>NDP</td>
            </tr>
            <tr>
                <td class="legend_colour liberals">&nbsp;&nbsp;&nbsp;&nbsp;</td>
                <td>Liberals</td>
            </tr>

            <tr>
                <td class="legend_colour greenparty">&nbsp;&nbsp;&nbsp;&nbsp;</td>
                <td>Green Party</td>
            </tr>
            <tr>
                <td class="legend_colour bloc">&nbsp;&nbsp;&nbsp;&nbsp;</td>
                <td>Bloc Quebecois</td>
            </tr>
            <tr>
                <td class="legend_colour other">&nbsp;&nbsp;&nbsp;&nbsp;</td>
                <td>Other</td>
            </tr>
        </table>
    </div>

</div>

      </div>

      <div class="row canyon" id="representation" style="padding: 70px; font-size: 130%;">
        <a class="anchor" name="representation"></a>
        <p>Proportional representation is a system used to elect a country's government. If proportional representation is used in an election, a political party that wins 10% of the vote, will win 10% of the seats in parliament and a party that wins 20% of the vote, will win 20% of the seats.</p>

        <p>If a party wins over 50% of the vote, it wins over 50% of the seats and can form a government, however this does not happen very often because most countries have lots of different political parties. If no party wins over 50% of the vote, then a coalition government usually has to be formed, where a government is formed from two or more different political parties, who together have over 50% of the seats in parliament.</p>

        <p>Source: <a style="color: skyblue;" href="http://simple.wikipedia.org/wiki/Proportional_representation">Proportional Representation on Wikipedia</a></p>
      </div>

      <div class="" id="aboutCODE">
        <a class="anchor" name="aboutCODE"></a>

        <img src="images/code_header.png" style="float: right;" />

        <p>This is a project submission for the 2015 <a href="http://open.canada.ca/en/canadian-open-data-experience-code">Canadian Open Data Experience</a>.</p>

        <p>Team: We Like To Sleep</p>

        <p>relation to theme of 'healthy living'?</p>

        <p>open data sets?</p>

        <p><a href="http://www.parl.gc.ca/HouseChamberBusiness/ChamberVoteList.aspx?Language=E&Mode=1&Parl=41&Ses=2">
          House of Commons, Parliamentary Business
        </a></p>

        <p>innovation?</p>
      </div>

    </div> <!-- /container -->


<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
<script src="d3.v3.js"></script>
<script src="Model.ChamberVoteDetail.js"></script>
<script src="Model.Parliament.js"></script>
<script src="voting.js"></script>
<script>
function populateVoteListing(parliament, session) {
  function doPopulateVoteListing(voteListing) {
    $('#votelist').empty();
    $.each(voteListing, function(index, value) {
        $('#votelist').append($('<option/>', { 
            value: value.voteNumber,
            text : value.voteNumber,
        }));
    });
  }

  // TODO: ask Neil about a better approach for lazy ajax fetch followed by acting on an object.
  // especially when I'm going to work with that object in multiple places. write checking code everywhere?
  // Neil says: yeah, check undefined, but keep one copy of the jQuery get and hang everything off of that. nice!
  // Alright, then how do I handle cache invalidations? probably the easiest way is to not do cache invalidation,
  // and just have an in-memory namespace. use the URL as the cache key.
  // Maybe I need to read about promises.
  var fetchUrl = 'data/parl'+parliament+'_sess'+session+'.xml';
  if (typeof cachedVoteListing[fetchUrl] != "undefined") {
    console.log('using cached version');
    doPopulateVoteListing(cachedVoteListing[fetchUrl]);
  } else {
    $.ajax({
      type : 'GET',
      url : fetchUrl,
      success : function(dataXML){
        cachedVoteListing[fetchUrl] = voteListingFromXml(dataXML);
        doPopulateVoteListing(cachedVoteListing[fetchUrl]);
      },
    });
  }
}

function populateCharts(parliament, session, vote) {
  var chamberVote = new ChamberVoteDetail(parliament, session, vote);

  // TODO: populate extra details from vote listing cache, or from the database
  chamberVote.description = 'description';
  chamberVote.bill = 'bill';

  chamberVote.fetchAsync(function(vote){
    var rescaledVote = vote.newScaledVote(alternateParliament);
    renderPieVoteSummary('#chart1', vote, false);
    renderPieVoteSummary('#chart2', rescaledVote, true);

    // TODO: also render the full elected parliament
    // maybe concentric rings could work for this?
    var pTest = vote.getParliamentToday();
    renderParliament('#parlchart1', pTest);
    renderParliament('#parlchart2', alternateParliament);

    $('#desctext').text(vote.description);
    $('#bill_name').text(vote.bill);
  });

  window.history.pushState({},"TITLE_NOT_IMPL", document.URL.replace(/#.*$/, "") + '#browse/'+parliament+'/'+session+'/'+vote);
}

$( document ).ready(function() {
  $('select#parl_session').change(function(){
    var keys = $(this).val().split(',');
    var parliament = keys[0];
    var session = keys[1];
    populateVoteListing(parliament, session);
  });
  $('select#votelist').change(function(){
    // TODO: wow, this is so hackish.
    var keys = $('#parl_session').val().split(',');
    var parliament = keys[0];
    var session = keys[1];
    var vote = $(this).val();
    populateCharts(parliament, session, vote);
  });

  $('#lnkNext').click(function() {
    $('#votelist > option:selected')
      .prop('selected', false)
      .next()
      .prop('selected', true);
    $('#votelist').trigger('change');
    return false; // disable page-scrolling behaviour of link
  });
  $('#lnkPrev').click(function() {
    $('#votelist > option:selected')
      .prop('selected', false)
      .prev()
      .prop('selected', true);
    $('#votelist').trigger('change');
    return false; // disable page-scrolling behaviour of link
  });

  var hash = window.location.hash;
  var parliament = 41;
  var session = 2;
  var vote = 329;
  if (hash.indexOf('#browse/') != -1) {
    var params = hash.replace('#browse/', '').split('/');
    parliament = params[0];
    session = params[1];
    vote = params[2];
  }

  $("#parl_session").val(parliament+','+session);
  populateVoteListing(parliament, session);

  // FIXME: setTimeout is a terrible way to do this.
  setTimeout(function() {
    $("#votelist").val(vote);
    populateCharts(parliament, session, vote);
  }, 1000);
});
</script>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
  </body>
</html>
