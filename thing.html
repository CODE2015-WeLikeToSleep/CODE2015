<!DOCTYPE html>
<meta charset="utf-8">
<head>
	<style>

	.chart rect {
	}

	.chart text {
	  fill: white;
	  font: 10px sans-serif;
	  text-anchor: end;
	}

	</style>
</head>
<body>


<svg class="chart"></svg>

 
<script src="https:////code.jquery.com/jquery-1.11.2.min.js"></script>
<script src="http://d3js.org/d3.v3.js"></script>
<script>

$( document ).ready(function() {

	$.ajax({
	    type :"GET",
	    url : 'parl41-sess1.xml',
	    success : function(dataXML){
	    	var data = [];
            $(dataXML).find('Votes').each(function(){
                $(this).find("Vote").each(function(){
                    var vote = {
                    	description: $(this).find("Description").text(),
	                    decision: $(this).find("Decision").text(),
	                    bill: $(this).find("RelatedBill").text(),
	                    yeas: Number($(this).find("TotalYeas").text()),
	                    nays: Number($(this).find("TotalNays").text()),
	                    paired: $(this).find("TotalPaired").text()
                    };

                    // console.log(vote);
                    data.push(vote);
                });
            });

            var width = 520;
		    var barHeight = 20;

		    // "Scales are functions that map from an input domain to an output range."
			var x = d3.scale.linear()
			    .domain([0, d3.max(data, function(d){return d.yeas + d.nays;})])
			    .range([0, width]);

			var chart = d3.select(".chart")
			    .attr("width", width)
			    .attr("height", barHeight * data.length);

			var bar = chart.selectAll("g")
			    .data(data)
			  .enter().append("g")
			    .attr("transform", function(d, i) { return "translate(0," + i * barHeight + ")"; });

			bar.append("rect")
				.attr("class", "yeas")
			    .attr("fill", "green")
			    .attr("x", 0 )
			    .attr("width", function(d){return x(d.yeas);} )
			    .attr("height", barHeight - 1);

			bar.append("rect")
				.attr("class", "nays")
			    .attr("fill", "red")
			    .attr("x", function(d) {return x(d.yeas);} )
			    .attr("width", function(d){return x(d.nays);} )
			    .attr("height", barHeight - 1);

			bar.append("text")
			    .attr("x", function(d) { return 30; })
			    .attr("y", barHeight / 2)
			    .attr("dy", ".35em")
			    .text(function(d) { return d.yeas; });

			bar.append("text")
			    .attr("x", function(d) { return x(d.yeas); })
			    .attr("y", barHeight / 2)
			    .attr("dy", ".35em")
			    .text(function(d) { return d.nays; });
	    },
	    error : function(){
	        //error handler..
	    }
	});

});

</script>




</body>
</html>